#### schema设计

- 良好的逻辑设计和物理设计是高性能的基石

#### 选择优化的数据类型

- 选择数据类型的几个简单原则：
    - 更小的通常更好
        - 更小的数据通常更快，因为他们占用的磁盘、内存和CPU缓存更少，并且处理时消耗的CPU时钟周期也更少。
        - 但也不能低估存储值的范围，如果无法确定哪个数据类型是最好的，请选择你认为不会超过的最小的数据类型。
    - 简单为好
        - 简单的数据类型的操作，通常需要更少的CPU周期，例如整型数据比字符型数据的比较操作代价更低，因为字符集和排序规则使字符型数据的比较更复杂。
    - 尽量避免存储NULL
        - 通常情况下最好指定为NOT NULL，除非明确需要存储NULL值。如果查询中包含可能为NULL的列，对Mysql来说更难优化，因为可能为NULL的列使得索引、索引统计和值的比较都更复杂。
        - 可为NULL的列或使用更多的存储空间

#### 数据类型别名

- Mysql为了兼容，使用更多的别名，例如：INTEGER（映射到INT）、BOOL（映射到TINYINT）、NUMERIC（映射到DECIMAL），  
  使用SHOW CREATE TABLE检查，会发现MYSQL报告的是基本类型，而不是别名。

#### 数据类型

- 整型
    - 有两种类型的数字：
        - 整数（whole number）
            - 如果是整数，可以使用这几种整数类型：TINYINT、SMALLINT、MEDIUMINT、INT、BIGINT，他们分别对应8，16，24，32，64位存储空间。
            - 整数有unsigned属性，这大致可以使正数的上限提高一倍。
            - 整数计算通常使用64位的BIGINT，（一些聚合函数是例外，他们使用DECIMAL、DOUBLE进行计算）
            - Mysql可以为整数指定宽度，例如INT（11），这对大多数应用毫无疑义，他不会限制值的合法范围，  
              只是规定了MYSQL的一些交互式工具（例如Mysql命令行客户端）  
              用来显示字符的个数。对于存储和计算来说INT（1）和INT（20）是一样的。
        - 实数（real number，带有小数部分的数字。有理数和无理数统称为实数，有理数 ：整数和分数统称为有理数.
          无理数 ：无限不循环小数.如√2,√3,√5,π,0.1010010001……,实数范围就大了,除了整数,还有小数,开根的,乱七八糟的都是实数,也就是说,
          可以运用数学算法]、各种定理能算出来的,都是实数.他区别于虚数.可以说,虚数是不存在的数,只是在一些高等数学等高科技领域计算时会用到.他们一起又统称复数.）
            - 实数是带有小数部分的数字。然而他们不仅适用于带小数的数字，也可以使用DECIMAL存储比BIGINT更大的整数。
            - Float占用4字节
            - Double占用8字节
            - Decimal，由于额外的空间和计算成本，应该尽量只在对小数进行精确计算时才使用decimal。可以考虑采用BIGINT来代替decimal，可以在使用时放大或者缩小对应的倍数。
        - Mysql默认采用double进行浮点类型的内部计算。整数计算通常采用64位的BIGINT。

- 字符串类型
    - varchar和char是两种最主要的字符串类型。遗憾的是很难精确的解释这两种类型是如何存储在磁盘中的，因为这跟存储引擎的具体实现有关。
    - varchar,
        - 字符串长度定义的是字符数，而不是字节数，多字节字符可能需要多个字节来存储一个字符。
        - varchar用于存储可变长度字符串，是最常见的字符串数据类型，他比固定长度的更节省空间，因为他仅使用必要的空间。
        - 下面情况使用varchar是合适的：字符串列的最大长度远大于平均长度；列的跟新很少，所以碎片不是问题；使用了像UTF-8这样复杂的字符集，每个字符都使用不同的字节进行存储。
    - char，
    - 适合存储非常短的字符串，或者适用于所有值的长度都几乎相同的情况，对于经常修改的数据，char也比varchar更好，因为固定长度的行不容易出现碎片。对于非常短的行，char比varchar也更高效。
        - 使用varchar(5)和varchar(200)存储‘hello
          world’的空间开销是一样的。但较大的列会使用更多的内存，因为mysql通常会在内部分配固定大小的内存块来保存值。这对于使用内存或磁盘临时表的排序或操作尤其糟糕
    - binary/varbinary,与char和varchar类似，他们存储的是二进制字符串。

- blob和text类型
    - BLOB和TEXT都是为存储很大数据而设计的字符串数据类型，分别采用二进制和字符串方式存储。
    - 实际上他们分属两组不同的数据类型家族
        - 字符类型是TINYTEXT、SMALLTEXT、TEXT、MEDIUMTEXT、LONGTEXT
        - 二进制类型是TINYBLOB、SMALLBLOB、MEDIUMBLOB、LONGBLOB
        - BLOB是SMALLBLOB的同义词，TEXT是SMALLTEXT的同义词
        - BLOB类型没有排序规则和字符集
    - 某些应用接受图像，并将它们作为BLOB数据存储在数据库中。如果可以的话，尽量不要讲数据库中存储像图像这样的数据，相反，应将它们存入单独的对象数据存储，并使用该表来跟踪图像位置或者文件名。

- enum
    - enum类型在mysql中是以int类型存储的，比某些情况下直接使用字符串要好很多，缺点就是链表查询性能不高
    - 设计enum字段时，可以置顶字段中选项顺序

- DATETIME和TIMESTAMP
    - DATETIME存储的值与时区无关，这需要8字节的存储空间。
    - TIMESTAMP，只使用4字节的存储空间，所以他的存储范围要比DATETIME小的多，只能从1970年到2038年。在默认情况下默认值位NOT
      NULL，这也和其他数据类型不一样。
    - Mysql提供了FROM_UNIXTIME()函数来将NUIX转换为日期。并提供了TIMESTAMP将日期转换为时间戳
    - 如果存储为时间戳，可以选择更大的int类型，32位的int可以存储到2038年，使用无符号的32位int可以存储到2106年，如果使用64位可以超出这个范围。

- 位压缩，BIT

- JSON类型
    - 存储为JSON格式个将其存储为很多列的格式相比，JSON的存储空间会更大，需要更多的空间来存储括号、冒号等。
    - 存储为JSON格式查询性能也略低于存储为多列模式。决定使用原生SQL还是JSON取决于数据中存储JSON的便捷性是否大于性能。如果每天访问这些数据数百万次或者数十亿次，速度差异就会累加起来。
    - 存储为JSON格式，对其中元素的查询方式为：

``` sql
select json_field_name -> '$.json_sub_field_name' from table_name
```

#### 选择标识符

- 一般来说，标识符是引用行及通常使其唯一的方式。
- 整数通常是标识符的最佳选择，因为他们速度快，并且可以自动递增。应该注意选择整数类型的范围，避免整数意外耗尽导致停机的事故发生。
- 如果可能，尽量避免使用字符串类型作为标识符的类型，因为他们很消耗空间，而且通常比整数类型慢。
- 如果存储通用唯一标识符（UUID）的值，则应该删除破折号，或者更好的做法是，使用UNHEX()
  函数将UUID值转换为16字节的数字，并将其存储在BINARY(16)列中，可使用HEX()函数，以16进制格式检索值。

#### 特殊类型

- IPV4，ipv4实际上是一个32为无符号整数，而不是字符串，用点好分成四段只是为了方便人们阅读。  
  所以应该讲IP地址存储为无符号整数。Mysql提供了INET_ATON()和INET_NTOA()函数将两种类型转换。

#### 联接

- Mysql限制每个链接为61个表